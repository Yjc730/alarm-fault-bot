<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Alarm-Fault 對話機器人（純前端｜中文解釋＋建議）</title>
<style>
:root { --bg:#0f1115; --panel:#161a22; --line:#252b36; --text:#e6e6e6; --muted:#a4afc4; --accent:#0078ff; }
body { margin:0; background:var(--bg); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC",sans-serif;}
.wrap { max-width:860px; margin:0 auto; padding:16px;}
.title { font-weight:800; font-size:20px; }
.desc { color:var(--muted); font-size:13px; margin-top:4px;}
.box { margin-top:12px; border:1px solid var(--line); border-radius:16px; background:var(--panel); padding:12px; height:64vh; overflow:auto;}
.msg { margin:8px 0; display:flex; gap:8px; align-items:flex-start;}
.msg.me { justify-content:flex-end;}
.bubble { padding:10px 12px; background:var(--accent); border-radius:12px; border:1px solid var(--line); color:white; }
.inputbar { display:flex; gap:8px; margin-top:10px; }
.inputbar input { flex:1; padding:8px 12px; border-radius:8px; border:1px solid var(--line); background:var(--panel); color:var(--text); }
.inputbar button { padding:8px 14px; border-radius:8px; background:var(--accent); color:white; border:none; cursor:pointer;}
</style>
</head>
<body>
<div class="wrap">
  <div class="title">Alarm-Fault 對話機器人（純前端｜中文解釋＋建議）</div>
  <div class="desc">輸入 ID（如 7115-2）或自然語句（如「7115-2 是什麼？」、「7115-2 要怎麼處理？」）。<br>資料僅來自同資料夾的 alarm_fault_data.json，離線可用。</div>
  <div class="box" id="msgs"></div>
  <div class="inputbar">
    <input id="input" placeholder="試試：7115-2 是什麼？ / 7115-2 要怎麼處理 / antenna fault"/>
    <button id="send">送出</button>
  </div>
</div>
<script>
const box = document.getElementById('msgs');
const input = document.getElementById('input');
const send = document.getElementById('send');
let data = [];

async function loadData() {
  const hint = document.createElement('div');
  hint.textContent = '正在載入資料...';
  hint.style.color = '#a4afc4';
  box.appendChild(hint);
  try {
    const resp = await fetch('./alarm_fault_data.json?cb=' + Date.now(), { cache: 'no-store' });
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    data = await resp.json();
    hint.textContent = '載入完成，共 ' + data.length + ' 筆。';
  } catch (e) {
    hint.textContent = '載入失敗：請確認 alarm_fault_data.json 與本頁在同一資料夾（大小寫需一致）。';
    console.error('JSON 載入錯誤', e);
    const tip = document.createElement('div');
    tip.style.color = '#f0b90b';
    tip.style.fontSize = '12px';
    tip.textContent = '如果剛更新檔案，請用無痕視窗或重新整理（Cmd/Ctrl + Shift + R）。';
    box.appendChild(tip);
  }
}

function appendMsg(text, mine=false){
  const div=document.createElement('div');
  div.className='msg'+(mine?' me':'');
  const bubble=document.createElement('div');
  bubble.className='bubble';
  bubble.textContent=text;
  div.appendChild(bubble);
  box.appendChild(div);
  box.scrollTop=box.scrollHeight;
}

send.onclick = async ()=>{
  const q=input.value.trim();
  if(!q) return;
  appendMsg(q,true);
  input.value='';
  const ans = await reply(q);
  appendMsg(ans,false);
};

async function reply(q){
  if(!data.length) return '資料尚未載入完成，請稍候。';
  const idMatch=data.find(d=>d['alert number (alarm-fault)']?.toLowerCase().includes(q.toLowerCase()));
  if(idMatch){
    return `ID: ${idMatch['alert number (alarm-fault)']}\n告警：${idMatch['alarm name']}\n故障：${idMatch['fault name']}\n意義：${idMatch['meaning']}`;
  }
  return '沒有符合的資料。請改用更精確的 ID 或關鍵字。';
}

loadData();
</script>
</body>
</html>