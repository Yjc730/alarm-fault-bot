<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Alarm-Fault 對話機器人（自動欄位對應）</title>
  <meta name="color-scheme" content="dark"/>

  <style>
    :root {
      --bg:#0f1115;
      --panel:#161a22;
      --line:#252b36;
      --text:#e6e6e6;
      --muted:#a4afc4;
      --accent:#2e6be6;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,
                 "Noto Sans TC","PingFang TC","Microsoft JhengHei",
                 Arial,sans-serif;
    }
    .wrap{ max-width:860px; margin:0 auto; padding:16px; }
    .title{ font-weight:800; font-size:20px; }
    .desc{ color:var(--muted); font-size:13px; margin-top:4px; }

    .box{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:var(--panel);
      overflow:hidden;
    }
    .msgs{
      height:64vh;
      overflow:auto;
      padding:12px;
    }

    .msg{
      margin:8px 0;
      display:flex;
      gap:8px;
      align-items:flex-start;
    }
    .msg.me{ justify-content:flex-end; }

    .bubble{
      padding:10px 12px;
      background:#11151e;
      border:1px solid var(--line);
      border-radius:12px;
      max-width:85%;
      white-space:pre-wrap;
      font-size:13px;
      line-height:1.45;
    }
    .msg.me .bubble{
      background:var(--accent);
      border-color:var(--accent);
      color:#fff;
    }

    .inputbar{
      display:flex;
      gap:8px;
      padding:10px;
      border-top:1px solid var(--line);
      background:#121620;
    }
    .inputbar input{
      flex:1;
      padding:12px;
      border-radius:10px;
      border:1px solid var(--line);
      background:#0d1119;
      color:var(--text);
    }
    .inputbar button{
      padding:12px 16px;
      border-radius:10px;
      border:1px solid var(--accent);
      background:var(--accent);
      color:#fff;
      cursor:pointer;
    }

    .tag{
      display:inline-block;
      padding:1px 6px;
      border:1px solid var(--line);
      border-radius:999px;
      font-size:11px;
      color:#b9c4db;
      margin-right:6px;
    }

    .kv{
      margin-top:6px;
      font-size:13px;
      color:#c8d1e6;
    }
    .kv b{ color:#9fb0d9; }
    .kv div{ margin:4px 0; }   /* Q1: 2 正常緊 */

    .subtle{ color:#9aa6bd; font-size:12px; }

    .btn-more{
      margin-top:6px;
      padding:4px 8px;
      border:1px solid var(--line);
      background:#1a1e2a;
      color:#b9c4db;
      border-radius:6px;
      cursor:pointer;
    }
    .btn-more:hover{ filter:brightness(1.08); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">Alarm-Fault 對話機器人（自動欄位對應）</div>
    <div class="desc">
      輸入 ID（如 <b>7115-2</b>）或自然語句（如「<i>7115-2 是什麼？</i>」「<i>該怎麼辦</i>」）。
      <span class="tag">資料僅來自本地 JSON</span>
      <span class="tag">LLM 翻譯（英文→繁中）</span>
    </div>

    <div class="box">
      <div id="msgs" class="msgs"></div>
      <div class="inputbar">
        <input id="q" type="text"
               placeholder="試試：7115-2 是什麼？ / 7115-2 要怎麼處理 / antenna fault">
        <button id="send">送出</button>
      </div>

      <label class="subtle" style="display:block;margin:6px 12px 0">
        <input id="useLLM" type="checkbox">
        啟用 LLM 翻譯（僅英文→繁中）
      </label>
    </div>

    <div id="hint" class="subtle">正在載入資料…</div>
  </div>

<script>
/* ===================== 基本 UI ===================== */
const msgs  = document.getElementById('msgs');
const q     = document.getElementById('q');
const send  = document.getElementById('send');
const hint  = document.getElementById('hint');
const llmBox = document.getElementById('useLLM');

let DATA = [];
let
